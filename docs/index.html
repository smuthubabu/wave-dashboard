<!doctype html>

<html lang="en">
<head>
    <style>
        .dataTables_filter{
            margin-bottom: 20px;
        }
        .navbar-toggler{
            visibility: hidden;
        }
        .odd {
            background-color: aqua;
        }

        .even {
            background-color: black;

        }

        .body {
            background-color: #505050
        }

        .table {
            background-color: #505050
        }

        .bg-green-txt-white {
            background-color: green;
            color: white;
        }

        .bg-red-txt-white {
            background-color: red;
            color: white;
        }

        .bg-gray-txt-white {
            background-color: gray;
            color: white;
        }
    </style>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Wave Dashboard</title>
    <span class="checkmark">
    <div class="checkmark_stem"></div>
    <div class="checkmark_kick"></div>
  </span>
    <!-- CSS only -->
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.4/css/jquery.dataTables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/1.11.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="./js/cropped-doughnut-creator.js"></script>

</head>
<body>
<header>
    <div class="collapse bg-dark" id="navbarHeader">
        <div class="container" style="visibility: hidden;">
            <div class="row">
                <div class="col-sm-4 offset-md-1 py-4">
                    <h4 class="text-white">Contact</h4>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-white">Follow on Twitter</a></li>
                        <li><a href="#" class="text-white">Like on Facebook</a></li>
                        <li><a href="#" class="text-white">Email me</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a href="#" class="navbar-brand d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor"
                     stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="me-2"
                     viewBox="0 0 24 24" visibility="hidden">
                    <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                    <circle cx="12" cy="13" r="4"/>
                </svg>
                <strong>Wave Dashboard</strong>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader"
                    aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </div>
</header>

<main>
    <section class="container">
        <div class="row pb-5 mb-5">
            <div class="col-md-12">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body" >
                                    <div id="sites-chart">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body">
                                    <div id="servers-chart">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="card text-center">
                                <div class="card-body" >
                                    <div id="cameras-chart">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div style="clear:both"></div>
            <div class="mb-5">&nbsp</div>
        </div>

        <table id="example" class="display" width="100%">
            <thead>
            <tr>

            </tr>
            <tr>
                <th class="bg-gray-txt-white">
                    Site

                </th>
                <th class="bg-gray-txt-white">
                    Status

                </th>
                <th class="bg-green-txt-white">
                    UP

                </th>
                <th class="bg-red-txt-white">
                    Down

                </th>
                <th class="bg-gray-txt-white">
                    Unknown

                </th>
                <th class="bg-green-txt-white">
                    UP

                </th>
                <th class="bg-red-txt-white">
                    Down

                </th>
                <th class="bg-gray-txt-white">
                    Unknown

                </th>

            </tr>
            </thead>
        </table>
    </section>


</main>


<script type="text/javascript">


    function initData() {
        $.getJSON("./data/sites.json", function (data) {
            console.log(data);
            writeTable(data);
            drawChart(data);


        });
    }

    function writeTable(siteData) {


        var tickIcon = function (data, type, row) {
            if (data == 1) {
                return '<i class="fa fa-check" style="color:green"/>';
            }
            return "";
        };
        var noZero = function renderZero(data) {
            if (data == 0) {
                return '';
            }
            return data;
        }
        const oldcolumns =
            [
                // {title: "Servers",data:none},
                //  {title: "Cameras"},
                {
                    title: "Site",
                    data: 'Site'
                },
                {title: "Status", data: 'Site-Status', render: tickIcon},
                {title: "UP", data: "Servers-UP"},
                {title: "Down", data: "Servers-Down", render: noZero},
                {title: "Unknown", data: "Servers-Unknown", render: noZero},
                {title: "Up", data: "Cameras-Up"},
                {title: "Down", data: "Cameras-Down", render: noZero},
                {title: "Unknown", data: "Cameras-Unknown", render: noZero}
            ]
        const columns = [
            // {title: "Servers",data:none},
            //  {title: "Cameras"},
            {data: 'Site'},
            {data: 'Site-Status', render: tickIcon},
            {data: "Servers-UP"},
            {data: "Servers-Down", render: noZero},
            {data: "Servers-Unknown", render: noZero},
            {data: "Cameras-Up"},
            {data: "Cameras-Down", render: noZero},
            {data: "Cameras-Unknown", render: noZero}
        ]

        $('#example').DataTable({
            // responsive:true,
            paging: true,
            filter: true,
            "orderCellsTop": true,
            data: siteData,
            columns


        });


    }


    function drawChart(data) {

        drawSiteChart(data);
        drawServerChart(data);
        drawCameraChart(data);
    }

    $(document).ready(function () {
        initData();

    });


    function drawSiteChart(data) {
        /*{
            "SiteId": "003",
            "Site": "003-Utrecht",
            "Place": "Utrecht",
            "Site-Status": "0",
            "Servers-UP": "4",
            "Servers-Down": "1",
            "Servers-Unknown": "0",
            "Cameras-Up": "4",
            "Cameras-Down": "2",
            "Cameras-Unknown": "0"
        }*/
       const aggregatedResult = data.reduce((acc,cur)=>{
            let {up,down} = acc;
            if(cur['Site-Status']==='0'){
                down++;
            }
            else {
                up++;
            }
            return {up,down}

        }, {up:0,down:0})
        const items = [
            {value: aggregatedResult.up, color: "green"},
            {value: aggregatedResult.down, color: "red"},
        ]


        let imgUrl = "./assets/site.svg";
        const result = DoughnutElement(items, {
            radius: 75,
            title: "Sites",
            titleColor: "#000000",
            thicknessSize: "M",
            gapSize: "L",
            labelSize: 12,
            labelColor: "white",
            backgroundColor: "white",
            imgUrl
        });
        const siteChartContainer = document.getElementById("sites-chart");
        siteChartContainer.appendChild(result);
    }

    function drawServerChart(data) {
        /*{
            "SiteId": "003",
            "Site": "003-Utrecht",
            "Place": "Utrecht",
            "Site-Status": "0",
            "Servers-UP": "4",
            "Servers-Down": "1",
            "Servers-Unknown": "0",
            "Cameras-Up": "4",
            "Cameras-Down": "2",
            "Cameras-Unknown": "0"
        }*/
       const aggregatedResult = data.reduce((acc,cur)=>{
            let {up,down,unknown} = acc;
           up+=parseInt(cur['Servers-UP']);
           down+=parseInt(cur['Servers-Down']);
           unknown+=parseInt(cur['Servers-Unknown']);
           console.log({up,down,unknown})
            return {up,down,unknown}

        }, {up:0,down:0,unknown:0})
        const items = [
            {value: aggregatedResult.up, color: "green"},
            {value: aggregatedResult.down, color: "red"},
            {value: aggregatedResult.unknown, color: "yellow"},
        ]


        let imgUrl = "./assets/server.svg";
        const result = DoughnutElement(items, {
            radius: 75,
            title: "Servers",
            titleColor: "#000000",
            thicknessSize: "M",
            gapSize: "L",
            labelSize: 12,
            labelColor: "white",
            backgroundColor: "white",
            imgUrl
        });
        const siteChartContainer = document.getElementById("servers-chart");
        siteChartContainer.appendChild(result);
    }
    function drawCameraChart(data) {
        /*{
            "SiteId": "003",
            "Site": "003-Utrecht",
            "Place": "Utrecht",
            "Site-Status": "0",
            "Servers-UP": "4",
            "Servers-Down": "1",
            "Servers-Unknown": "0",
            "Cameras-Up": "4",
            "Cameras-Down": "2",
            "Cameras-Unknown": "0"
        }*/
       const aggregatedResult = data.reduce((acc,cur)=>{
            let {up,down,unknown} = acc;
            up+=parseInt(cur['Cameras-Up']);
            down+=parseInt(cur['Cameras-Down']);
            unknown+=parseInt(cur['Cameras-Unknown']);
            return {up,down,unknown}

        }, {up:0,down:0,unknown:0})
        const items = [
            {value: aggregatedResult.up, color: "green"},
            {value: aggregatedResult.down, color: "red"},
            {value: aggregatedResult.unknown, color: "yellow"},
        ]


        let imgUrl = "./assets/camera.svg";
        const result = DoughnutElement(items, {
            radius: 75,
            title: "Cameras",
            titleColor: "#000000",
            thicknessSize: "M",
            gapSize: "L",
            labelSize: 12,
            labelColor: "white",
            backgroundColor: "white",
            imgUrl
        });
        const siteChartContainer = document.getElementById("cameras-chart");
        siteChartContainer.appendChild(result);
    }


</script>


</body>

</html>
